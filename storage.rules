
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Rules for event images
    match /event-images/{allPaths=**} {
      // Allow any authenticated user to read event images
      allow read: if request.auth != null;

      // Allow users with 'organizer', 'coadmin', or 'admin' role to upload/write event images
      allow write: if request.auth != null &&
                       exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
                       get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role in ['organizer', 'coadmin', 'admin'];
    }

    // To be explicit, you can add a rule to deny all other access,
    // though Firebase Storage rules are deny-by-default if no other rule allows access.
    // match /{allPaths=**} {
    //  allow read, write: if false;
    // }
  }
}
